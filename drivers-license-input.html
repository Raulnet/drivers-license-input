<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<!--
`drivers-license-input`
An Input field that validates the driver license based on the Json file

@demo demo/index.html
-->

<dom-module id="drivers-license-input">
	<template>
		<style>
			:host {
				display: block;
			}

			.container {
				@apply(--layout-flex);
				@apply(--layout-vertical);
			}

			paper-item {
				padding-left: 32px;
				padding-right: 32px;
			}
		</style>
		<div class="container">
			<paper-dropdown-menu id="state" label="[[stateLabel]]" title$="[[stateTitle]]" required="[[required]]" auto-validate="[[autoValidate]]" error-message="[[stateErrorMessage]]" invalid="{{invalid}}">
				<paper-listbox class="dropdown-content" selected="{{state}}" attr-for-selected="name">
					<template is="dom-repeat" items="[[_states]]">
						<paper-item name="[[item]]">[[item]]</paper-item>
					</template>
				</paper-listbox>
			</paper-dropdown-menu>
			<paper-input id="driversLicenseNumber" label="[[driversLicenseLabel]]" disabled$="[[disabled]]" value="{{value}}" pattern="[[_pattern]]" autocomplete$="[[autocomplete]]" required="[[required]]" auto-validate="[[autoValidate]]" title$="[[driversLicenseTitle]]" error-message="[[errorMessage]]"
							invalid="{{invalid}}"></paper-input>
		</div>
	</template>

	<script>
		Polymer({

			is: 'drivers-license-input',

			properties: {
				driversLicenseLabel: {
					type: String,
					value: 'Drivers License Number'
				},
				stateLabel: {
					type: String,
					value: 'State'
				},
				driversLicenseTitle: {
					type: String,
					value: 'State issued driverâ€™s license number'
				},
				stateTitle: {
					type: String,
					value: 'State abbreviation'
				},
				value: {
					type: String,
					notify: true
				},
				errorMessage: {
					type: String,
					value: 'Drivers License Number is invalid'
				},
				stateErrorMessage: {
					type: String,
					value: 'Please Select a Sate.'
				},
				state: {
					type: String,
					observer: '_stateChanged'
				},
				_pattern: {
					type: String,
					value: '^[0-9]{1,7}$'
				},
				_rules: {
					type: Object,
					observer: '_rulesChanged'
				},

				_states: {
					type: Array
				},

				required: {
					type: Boolean,
					value: false
				},

				autoValidate: {
					type: Boolean,
					value: false
				},

				disabled: {
					type: Boolean,
					value: false
				},

				invalid: {
					type: Boolean,
					value: false
				},

				autocomplete: {
					type: Boolean,
					value: false
				},				

			},
			validate: function() {

				return this.$.driversLicenseNumber.validate();
			},
			_stateChanged: function(state) {

				this.$.driversLicenseNumber.disabled = false;
				this._pattern = this._rules[state].rule;
				this.errorMessage = "Drivers License should have at least " + this._rules[state].description.join(' ');
			},
			_rulesChanged: function(rules) {
				this._states = Object.keys(rules);
			},
			attached: function() {
				fetch('../regex.json').then((response) => {
					var contentType = response.headers.get("content-type");
					if (contentType && contentType.indexOf("application/json") !== -1) {
						return response.json().then((json) => {
							this._rules = json;
						});
					} else {
						console.error("Missing Json File!");
					}
				});
			},

		});
	</script>
</dom-module>
